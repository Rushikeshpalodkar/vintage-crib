<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eBay Catalog Search - Auto-Population Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #0064d2 0%, #1e88e5 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .main-content {
            padding: 30px;
        }

        .search-section {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .search-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #0064d2;
        }

        .search-btn {
            background: linear-gradient(135deg, #0064d2 0%, #1e88e5 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: transform 0.2s;
            grid-column: 1 / -1;
            justify-self: center;
        }

        .search-btn:hover {
            transform: translateY(-2px);
        }

        .results-section {
            display: none;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .product-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            cursor: pointer;
        }

        .product-card:hover {
            transform: translateY(-5px);
        }

        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .product-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
            line-height: 1.4;
        }

        .product-details {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
        }

        .product-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .use-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            cursor: pointer;
            transition: background 0.3s;
        }

        .use-btn:hover {
            background: #45a049;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0064d2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .selected-product {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border: 2px solid #0064d2;
        }

        .create-listing-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa500 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .search-form {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè™ eBay Catalog Search</h1>
            <p>Find products in eBay's catalog to auto-populate listing details</p>
        </div>

        <div class="main-content">
            <div class="search-section">
                <h3>Search eBay Product Catalog</h3>
                <p>Search by product identifiers for the most accurate results, or use keywords for general search.</p>
                
                <div class="search-form">
                    <div class="form-group">
                        <label for="query">Product Name/Keywords</label>
                        <input type="text" id="query" placeholder="e.g., iPhone 13 Pro Max">
                    </div>
                    
                    <div class="form-group">
                        <label for="brand">Brand</label>
                        <input type="text" id="brand" placeholder="e.g., Apple, Nike, Samsung">
                    </div>
                    
                    <div class="form-group">
                        <label for="upc">UPC Code</label>
                        <input type="text" id="upc" placeholder="e.g., 194252707067">
                    </div>
                    
                    <div class="form-group">
                        <label for="ean">EAN Code</label>
                        <input type="text" id="ean" placeholder="e.g., 0194252707067">
                    </div>
                    
                    <div class="form-group">
                        <label for="mpn">MPN (Model Number)</label>
                        <input type="text" id="mpn" placeholder="e.g., MLVF3LL/A">
                    </div>
                    
                    <button class="search-btn" onclick="searchCatalog()">
                        üîç Search eBay Catalog
                    </button>
                </div>
            </div>

            <div class="loading" id="loadingSection">
                <div class="spinner"></div>
                <p>Searching eBay catalog...</p>
            </div>

            <div class="results-section" id="resultsSection">
                <h3>Search Results</h3>
                <p id="resultsCount"></p>
                <div class="product-grid" id="productGrid"></div>
                <div class="no-results" id="noResults" style="display: none;">
                    No products found. Try different search terms or identifiers.
                </div>
            </div>

            <div class="selected-product" id="selectedProduct" style="display: none;">
                <h3>‚úÖ Selected Product</h3>
                <div id="selectedProductDetails"></div>
                <button class="create-listing-btn" onclick="createListingFromSelected()">
                    üöÄ Create eBay Listing
                </button>
            </div>
        </div>
    </div>

    <script>
        let selectedProductData = null;

        async function searchCatalog() {
            const query = document.getElementById('query').value.trim();
            const brand = document.getElementById('brand').value.trim();
            const upc = document.getElementById('upc').value.trim();
            const ean = document.getElementById('ean').value.trim();
            const mpn = document.getElementById('mpn').value.trim();

            if (!query && !upc && !ean && !(mpn && brand)) {
                alert('Please provide either:\n- Product name/keywords\n- UPC code\n- EAN code\n- MPN + Brand');
                return;
            }

            showLoading();

            const searchData = {
                query: query,
                brand: brand,
                upc: upc,
                ean: ean,
                mpn: mpn
            };

            try {
                const response = await fetch('/api/ebay/catalog/search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(searchData)
                });

                const result = await response.json();
                hideLoading();

                if (result.success && result.products.length > 0) {
                    displayResults(result.products, result.total);
                } else {
                    showNoResults();
                }

            } catch (error) {
                hideLoading();
                alert('Search failed: ' + error.message);
            }
        }

        function displayResults(products, total) {
            const resultsSection = document.getElementById('resultsSection');
            const resultsCount = document.getElementById('resultsCount');
            const productGrid = document.getElementById('productGrid');
            const noResults = document.getElementById('noResults');

            resultsCount.textContent = `Found ${products.length} products${total ? ` (${total} total available)` : ''}`;
            
            productGrid.innerHTML = '';
            noResults.style.display = 'none';

            products.forEach(product => {
                const productCard = createProductCard(product);
                productGrid.appendChild(productCard);
            });

            resultsSection.style.display = 'block';
        }

        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.onclick = () => selectProduct(product);

            const imageUrl = product.primaryImage || 'https://via.placeholder.com/200x200?text=No+Image';
            const title = product.title || 'Untitled Product';
            const brand = product.brand || 'Unknown Brand';
            const mpn = product.mpn || 'N/A';
            const category = product.categoryName || 'Uncategorized';

            card.innerHTML = `
                <img src="${imageUrl}" alt="${title}" class="product-image" onerror="this.src='https://via.placeholder.com/200x200?text=No+Image'">
                <div class="product-title">${title}</div>
                <div class="product-details">
                    <strong>Brand:</strong> ${brand}<br>
                    <strong>MPN:</strong> ${mpn}<br>
                    <strong>Category:</strong> ${category}
                </div>
                <div class="product-meta">
                    <span style="font-size: 0.8em; color: #999;">Product ID: ${product.productId}</span>
                    <button class="use-btn" onclick="event.stopPropagation(); selectProduct(${JSON.stringify(product).replace(/"/g, '&quot;')})">
                        Use This Product
                    </button>
                </div>
            `;

            return card;
        }

        function selectProduct(product) {
            selectedProductData = product;
            
            const selectedSection = document.getElementById('selectedProduct');
            const selectedDetails = document.getElementById('selectedProductDetails');

            const imageUrl = product.primaryImage || 'https://via.placeholder.com/200x200?text=No+Image';
            
            selectedDetails.innerHTML = `
                <div style="display: grid; grid-template-columns: 200px 1fr; gap: 20px; align-items: start;">
                    <img src="${imageUrl}" alt="${product.title}" style="width: 100%; border-radius: 10px;" onerror="this.src='https://via.placeholder.com/200x200?text=No+Image'">
                    <div>
                        <h4>${product.title}</h4>
                        <p><strong>Brand:</strong> ${product.brand || 'Unknown'}</p>
                        <p><strong>MPN:</strong> ${product.mpn || 'N/A'}</p>
                        <p><strong>UPC:</strong> ${product.upc || 'N/A'}</p>
                        <p><strong>EAN:</strong> ${product.ean || 'N/A'}</p>
                        <p><strong>Category:</strong> ${product.categoryName || 'Uncategorized'} (${product.categoryId || 'N/A'})</p>
                        <p><strong>Description:</strong> ${product.description || 'No description available'}</p>
                    </div>
                </div>
            `;

            selectedSection.style.display = 'block';
            selectedSection.scrollIntoView({ behavior: 'smooth' });
        }

        async function createListingFromSelected() {
            if (!selectedProductData) {
                alert('No product selected');
                return;
            }

            const price = prompt('Enter selling price (USD):', '25.99');
            if (!price || isNaN(price)) {
                alert('Please enter a valid price');
                return;
            }

            const quantity = prompt('Enter quantity:', '1');
            if (!quantity || isNaN(quantity) || quantity < 1) {
                alert('Please enter a valid quantity');
                return;
            }

            const condition = prompt('Enter condition:', 'NEW') || 'NEW';

            const listingData = {
                title: selectedProductData.title,
                description: selectedProductData.description || 'High-quality product in excellent condition.',
                brand: selectedProductData.brand,
                mpn: selectedProductData.mpn,
                upc: selectedProductData.upc,
                ean: selectedProductData.ean,
                condition: condition,
                categoryId: selectedProductData.categoryId,
                price: parseFloat(price),
                quantity: parseInt(quantity),
                images: selectedProductData.additionalImages || [selectedProductData.primaryImage].filter(Boolean),
                aspects: selectedProductData.aspects || {}
            };

            try {
                showLoading();
                
                const response = await fetch('/api/ebay/create-complete-listing', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(listingData)
                });

                const result = await response.json();
                hideLoading();

                if (result.success) {
                    alert(`‚úÖ Listing Created Successfully!\n\nSKU: ${result.sku}\nListing ID: ${result.listingId}\n\nYour product is now live on eBay!`);
                    
                    if (result.ebayUrl) {
                        const openListing = confirm('Would you like to view your live eBay listing?');
                        if (openListing) {
                            window.open(result.ebayUrl, '_blank');
                        }
                    }
                } else {
                    alert('‚ùå Listing Creation Failed:\n' + result.error);
                }

            } catch (error) {
                hideLoading();
                alert('‚ùå Error creating listing: ' + error.message);
            }
        }

        function showLoading() {
            document.getElementById('loadingSection').style.display = 'block';
            document.getElementById('resultsSection').style.display = 'none';
        }

        function hideLoading() {
            document.getElementById('loadingSection').style.display = 'none';
        }

        function showNoResults() {
            const resultsSection = document.getElementById('resultsSection');
            const productGrid = document.getElementById('productGrid');
            const noResults = document.getElementById('noResults');
            
            productGrid.innerHTML = '';
            noResults.style.display = 'block';
            resultsSection.style.display = 'block';
        }

        // Auto-search if URL parameters are provided
        window.addEventListener('load', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const query = urlParams.get('q');
            if (query) {
                document.getElementById('query').value = query;
                searchCatalog();
            }
        });
    </script>
</body>
</html>